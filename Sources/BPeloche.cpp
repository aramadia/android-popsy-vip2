	   			 /*---------------------------------------------------------------------+
				  |							BPeloche.cpp								|
				  |																		|
				  |	 une sorte de gros layer avec plein de defaut ( comme sur un vieux	|
				  |						film super 8 koa ).								|
				  |																		|
				  | 	U2^PoPsy TeAm 2000												|
				  +---------------------------------------------------------------------*/

#include "stdafx.h"


//----------------------------------------------------------------------------------------------------------------------------------------
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//									+-----------------------+
//									|	Variables Locales	|
//									+-----------------------+
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//----------------------------------------------------------------------------------------------------------------------------------------

TextureU3D*		BPeloche::TexPic1 = NULL	;
MaterialU3D*	BPeloche::MatPic1 = NULL	;
BitmapU3D*		BPeloche::GBmp =  NULL		;



//-----------------------------------------------------------------------------------------------------------------------------------------
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//										+-------------------+
//										|  Class BPeloche	|
//										+-------------------+
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//-----------------------------------------------------------------------------------------------------------------------------------------
void BPeloche::Initialise()
{
	GBmp = new BitmapU3D( NULL )	;

	TextureManager::SetRepertoire( "" )																	;
	TexPic1 = TextureManager::OpenJpg( "Datas/2d/BruitPeloche.jpg", BILINEAR_TEXTURE|TILE_TEXTURE  )	;
	TexPic1->IncUser()																					;

	MatPic1	= new MaterialU3D( "MatPic1" )	;
	MatPic1->SetTexture1( TexPic1 )			;
	MatPic1->SetTransp( MatTranspAddAlpha )	;
	MatPic1->SetShading( MatShadingRien )	;
	MatPic1->Confirm()						;
}
//-----------------------------------------------------------------------------------------------------------------------------------------
void BPeloche::Release()
{
	DeleteBlinde( MatPic1 )	;
	DeleteBlinde( GBmp )	;

	TextureManager::SubUse( TexPic1 )	;}
//-----------------------------------------------------------------------------------------------------------------------------------------
BPeloche::BPeloche()
{
	time = 0.0f	;

	Alpha = 1.0f		;
	IncAlpha = 0.0f		;
	GotoAlpha = 1.0f	;
}
//-----------------------------------------------------------------------------------------------------------------------------------------
void BPeloche::Interposalpha( Ufloat debut, Ufloat fin, Ufloat time )
{
	Alpha = debut		;
	GotoAlpha = fin		;

	IncAlpha = ( fin - debut ) / time	;
}
//-----------------------------------------------------------------------------------------------------------------------------------------
void BPeloche::UpdateFrame( Ufloat laptime )
{
	U32 tp = time + Random1()*.4f 	;

	time += laptime	;

	MatPic1->SetAlpha( Alpha * ( .5f + fabs(.5f*sin( time*3.f+ Random1() )) ) )	;

	MatPic1->SetTex1Pos( cos( time*5.5f )*.6f + Random1()*.4f, Random1(), 1.0f, 1.0f )	;

	U3D3Pipeline->Begin( MatPic1 )	;

		GBmp->SetCoord( 0, 0.0f, 0.0f )	;
		GBmp->SetCoord( 1, 1.0f, 0.0f )	;
		GBmp->SetCoord( 2, 1.0f, 1.0f )	;
		GBmp->SetCoord( 3, 0.0f, 1.0f )	;

		GBmp->Affiche()	;

	U3D3Pipeline->End( MatPic1 )	;
}
//-----------------------------------------------------------------------------------------------------------------------------------------
